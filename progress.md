# 自习座位预约系统开发进度

## 用户故事

### 管理员相关用户故事

1. **自习室管理**
   - 作为管理员，我希望能够添加自习室，以便增加可用的自习空间
   - 作为管理员，我希望能够修改自习室信息，以便更新自习室状态
   - 作为管理员，我希望能够删除自习室，以便移除不再使用的自习室
   - 作为管理员，我希望能够设置自习室的开放时间，以满足不同场地的使用需求
   - 作为管理员，我希望能够设置自习室的归属（全校或特定院系），以控制访问权限

2. **座位管理**
   - 作为管理员，我希望能够添加座位，以便增加自习室的座位资源
   - 作为管理员，我希望能够修改座位信息，以更新座位状态
   - 作为管理员，我希望能够删除座位，以移除不可用的座位
   - 作为管理员，我希望能够标记座位的特殊属性（如靠近插座），以便学生筛选

3. **签到管理**
   - 作为管理员，我希望能够管理每日的签到二维码/编码，以便学生签到验证
   - 作为管理员，我希望能够查看签到情况，以监控座位实际使用情况

4. **数据管理**
   - 作为管理员，我希望能够查看预约数据和统计信息，以优化资源配置
   - 作为管理员，我希望能够查看学生违约记录，以便实施管理措施
   - 作为管理员，我希望能够导出使用数据，以便进行离线分析

5. **系统管理**
   - 作为管理员，我希望能够调整系统参数（如最大预约时长），以适应不同场景需求
   - 作为管理员，我希望能够管理管理员账号，以分配管理权限
   - 作为管理员，我希望能够发布自习室临时关闭等通知，以应对突发情况

### 学生相关用户故事

1. **浏览与搜索**
   - 作为学生，我希望能够浏览所有对我开放的自习室，以选择合适的自习场所
   - 作为学生，我希望能够查看自习室座位的可用情况，以便预约座位
   - 作为学生，我希望能够按时间段筛选可用座位，以找到合适的自习时间
   - 作为学生，我希望能够按特殊属性（如靠近插座）筛选座位，以满足特定需求
   - 作为学生，我希望能够搜索特定的自习室或座位，以快速定位熟悉的位置

2. **预约管理**
   - 作为学生，我希望能够预约座位，以保证自习位置
   - 作为学生，我希望能够一次性预约多个连续时间段，以便长时间学习
   - 作为学生，我希望能够取消预约，以便在计划变更时释放资源
   - 作为学生，我希望能够延长预约时间（如果后续时间段可用），以便继续学习
   - 作为学生，我希望能够查看我当前的预约，以了解我的自习安排

3. **签到与使用**
   - 作为学生，我希望能够通过扫码签到，以确认我已到达预约座位
   - 作为学生，我希望能够通过输入编码签到，以在不方便扫码的情况下完成签到
   - 作为学生，我希望能够提前结束使用，以便释放不再需要的座位

4. **个人中心**
   - 作为学生，我希望能够查看我的历史预约记录，以了解我的自习习惯
   - 作为学生，我希望能够查看我的违约记录，以了解自己的预约履行情况
   - 作为学生，我希望能够收藏常用自习室或座位，以便快速预约
   - 作为学生，我希望能够设置个人偏好，以获得更符合需求的推荐

5. **通知与提醒**
   - 作为学生，我希望能够收到预约前的提醒通知，以避免忘记预约时间
   - 作为学生，我希望能够收到迟到提醒，以避免因忘记签到而被取消预约
   - 作为学生，我希望能够收到自习室临时关闭等通知，以便及时调整计划

### 系统相关用户故事

1. **通知系统**
   - 系统应在预约前15分钟发送提醒通知
   - 系统应在预约时间10分钟后发送迟到提醒
   - 系统应在预约时间15分钟后自动取消未签到的预约并记录违约

2. **安全与认证**
   - 系统应提供用户认证和权限控制机制
   - 系统应保护用户隐私和数据安全

3. **数据处理**
   - 系统应生成每日的签到编码/二维码
   - 系统应记录和分析座位利用数据
   - 系统应提供统计报表功能

## 开发规划

### 阶段一：项目初始化与基础架构

1. **前端初始化**
   - 创建微信小程序项目
   - 设计UI/UX原型
   - 实现基础组件库
   - 配置路由和全局状态管理

2. **后端初始化**
   - 搭建Spring Boot框架
   - 配置MyBatis-Plus
   - 设计并创建数据库结构
   - 实现用户认证系统
   - 配置开发环境

3. **基础功能实现**
   - 管理员和学生登录/注册
   - 基础数据模型和API
   - 前后端通信测试

### 阶段二：核心功能开发

1. **管理员功能**
   - 自习室管理（增删改查）
   - 座位管理（增删改查）
   - 签到码生成系统
   - 基础统计数据展示

2. **学生功能**
   - 自习室和座位浏览
   - 基础预约功能
   - 签到功能
   - 个人中心基础功能

3. **系统功能**
   - 基础通知系统
   - 数据验证和错误处理
   - 预约冲突处理机制

### 阶段三：高级功能与优化

1. **管理员高级功能**
   - 高级数据分析和可视化
   - 批量操作功能
   - 系统参数配置

2. **学生高级功能**
   - 高级搜索筛选
   - 预约历史与再次预约
   - 座位收藏功能
   - 延长预约功能

3. **系统高级功能**
   - 完整的通知与提醒系统
   - 违约记录与处理机制
   - 性能优化
   - 安全加固

### 阶段四：测试与部署

1. **测试**
   - 单元测试
   - 集成测试
   - 用户测试
   - 性能测试

2. **部署**
   - 后端服务部署
   - 微信小程序发布
   - 数据库配置与优化
   - 监控系统部署

3. **文档与培训**
   - 用户手册编写
   - 管理员指南编写
   - 系统维护文档编写

## 前后端任务拆分

### 前端任务（微信小程序）

1. **UI设计与实现**
   - 页面布局设计
   - 组件库开发
   - 主题与样式设置

2. **用户认证页面**
   - 登录页面
   - 授权页面
   - 个人信息页面

3. **自习室浏览**
   - 自习室列表页
   - 自习室详情页
   - 筛选与搜索功能

4. **座位预约**
   - 座位选择界面
   - 时间段选择界面
   - 预约确认界面
   - 预约管理界面

5. **签到系统**
   - 扫码签到功能
   - 手动输入编码签到
   - 签到状态展示

6. **个人中心**
   - 当前预约展示
   - 历史预约记录
   - 违约记录
   - 个人设置

7. **通知系统**
   - 消息列表页
   - 消息详情页
   - 订阅消息授权

### 后端任务（Spring Boot + MyBatis-Plus）

1. **项目结构搭建**
   - Spring Boot项目初始化
   - 整合MyBatis-Plus
   - 配置文件设置
   - 项目分层（Controller, Service, Mapper, Entity等）

2. **用户认证系统**
   - JWT认证实现
   - Spring Security配置
   - 权限控制
   - 用户角色管理

3. **自习室管理**
   - 自习室实体设计
   - 自习室CRUD接口
   - 自习室查询与筛选接口
   - 自习室权限验证

4. **座位管理**
   - 座位实体设计
   - 座位CRUD接口
   - 座位查询与筛选接口
   - 座位状态管理

5. **预约系统**
   - 预约实体设计
   - 预约创建接口
   - 预约取消接口
   - 预约延长接口
   - 预约冲突检测
   - 预约状态管理

6. **签到系统**
   - 签到实体设计
   - 签到码生成接口
   - 签到验证接口
   - 签到状态管理
   - 违约自动处理

7. **通知系统**
   - 消息实体设计
   - Spring定时任务
   - 微信订阅消息接口集成
   - 通知发送服务

8. **数据分析**
   - 统计数据接口
   - 报表生成
   - 数据导出功能

9. **系统管理**
   - 系统参数实体设计
   - 系统参数配置接口
   - 管理员账号管理接口
   - 系统日志实现

## 需要注意的事项

1. **微信小程序相关**
   - 微信登录与授权流程需特别注意
   - 订阅消息有次数和类型限制
   - 小程序审核可能需要多次修改
   - 小程序页面跳转和数据传递有特定限制

2. **后端安全相关**
   - 接口权限控制必须严格实现
   - 数据库查询需防止SQL注入（使用MyBatis-Plus参数绑定）
   - API请求需做频率限制，防止恶意请求
   - 敏感数据加密存储
   - Spring Security正确配置

3. **业务逻辑相关**
   - 预约冲突检测需要严格测试
   - 时间处理需考虑时区问题
   - 签到和违约处理的时间计算要准确
   - 并发预约可能导致的问题需要解决

4. **性能相关**
   - 预约高峰期系统负载可能较大
   - 数据库查询优化（索引、缓存等）
   - 长期运行的数据清理与归档策略
   - 服务器资源监控与扩展策略

5. **用户体验相关**
   - 预约流程应尽量简化
   - 错误提示应友好明确
   - 网络不稳定情况的处理
   - 页面加载和响应速度优化

# 任务清单

## 初始化阶段任务

### 环境搭建
- [x] 安装JDK 11
  - 安装路径: D:\Java\JDK
  - 版本: java version "11.0.26" 2025-01-21 LTS
  - Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.26+7-LTS-187, mixed mode)
- [x] 安装Maven 3.6+
  - 安装路径: D:\Maven\apache-maven-3.6.1
  - 版本: Apache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-05T03:00:29+08:00)
- [x] 安装MySQL 8.0+
  - 版本: 8.0.40 MySQL Community Server - GPL
  - 连接: mysql -u root -proot
- [x] 安装微信开发者工具
- [x] 安装开发IDE（VSCode）

### 后端初始化
- [x] 创建Spring Boot项目（使用Spring Initializr）
  - Spring Boot 版本: 2.7.14
  - 项目结构: com.studyseat.reserve
  - 主要依赖: 
    - MyBatis-Plus 3.5.3.1
    - JWT 0.9.1
    - Druid 1.2.16
    - Spring Security
    - Knife4j 2.0.9
    - Lombok
    - FastJSON 2.0.32
- [x] 配置pom.xml添加所需依赖（Spring Web, MyBatis-Plus, MySQL, JWT等）
- [x] 创建项目基础结构（controller/service/mapper/entity/dto等包）
  - controller: 控制层，处理HTTP请求
  - service: 业务逻辑层
  - mapper: 数据访问层
  - entity: 实体类
  - dto: 数据传输对象
  - vo: 视图对象
  - config: 配置类
  - exception: 异常处理
  - common: 通用工具类
  - util: 工具类
- [x] 配置application.yml（数据库连接、服务器端口等）
  - 服务端口: 8080
  - 数据库URL: jdbc:mysql://localhost:3306/studyseat
  - 数据库用户名: root
  - 数据库密码: root
- [x] 配置MyBatis-Plus
  - 主键策略: AUTO
  - 逻辑删除: 已配置
  - 类型别名包: com.studyseat.reserve.entity
  - Mapper XML位置: classpath*:/mapper/**/*.xml
- [x] 配置跨域支持
- [x] 创建统一响应格式类
- [x] 创建全局异常处理器

### 数据库设计与初始化
- [x] 设计用户表（User/Admin/Student）
  - 用户表(user): 存储所有用户基本信息
    - id: 用户ID，主键，自动递增
    - username: 用户名，唯一
    - password: 密码(加密存储)
    - real_name: 真实姓名
    - phone: 手机号
    - email: 邮箱
    - avatar: 头像URL
    - open_id: 微信OpenID，唯一
    - user_type: 用户类型，1-管理员，2-学生
    - status: 状态，0-禁用，1-正常
    - create_time: 创建时间
    - update_time: 更新时间
  
  - 管理员表(admin): 存储管理员特有信息
    - id: 管理员ID，主键，自动递增
    - user_id: 关联用户ID，外键
    - admin_type: 管理员类型，1-系统管理员，2-自习室管理员
    - department: 所属部门
    - create_time: 创建时间
    - update_time: 更新时间
  
  - 学生表(student): 存储学生特有信息
    - id: 学生ID，主键，自动递增
    - user_id: 关联用户ID，外键
    - student_id: 学号，唯一
    - college: 学院
    - major: 专业
    - grade: 年级
    - class_name: 班级
    - violation_count: 违约次数
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 设计自习室表（StudyRoom）
  - 自习室表(study_room): 存储自习室信息
    - id: 自习室ID，主键，自动递增
    - name: 自习室名称
    - location: 位置描述
    - building: 所在建筑
    - floor: 所在楼层
    - room_number: 房间号
    - capacity: 座位容量
    - description: 详细描述
    - open_time: 开放时间(开始)
    - close_time: 开放时间(结束)
    - belongs_to: 归属(全校/特定院系)
    - is_active: 是否开放，0-关闭，1-开放
    - admin_id: 管理员ID，外键
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 设计座位表（Seat）
  - 座位表(seat): 存储座位信息
    - id: 座位ID，主键，自动递增
    - study_room_id: 所属自习室ID，外键
    - seat_number: 座位编号
    - row_number: 行号
    - column_number: 列号
    - has_power: 是否有电源，0-无，1-有
    - is_window: 是否靠窗，0-否，1-是
    - is_corner: 是否角落，0-否，1-是
    - status: 状态，0-停用，1-正常
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 设计预约表（Reservation）
  - 预约表(reservation): 存储预约信息
    - id: 预约ID，主键，自动递增
    - student_id: 学生ID，外键
    - seat_id: 座位ID，外键
    - start_time: 开始时间
    - end_time: 结束时间
    - status: 状态，0-已取消，1-待签到，2-使用中，3-已完成，4-已违约
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 设计签到表（CheckIn）
  - 签到表(check_in): 存储签到信息
    - id: 签到ID，主键，自动递增
    - reservation_id: 预约ID，外键
    - check_in_time: 签到时间
    - check_in_type: 签到类型，1-扫码签到，2-手动输入编码
    - check_out_time: 签退时间(可为空，表示未签退)
    - check_code: 签到码
    - create_time: 创建时间
    - update_time: 更新时间
  
  - 违约记录表(violation): 存储违约信息
    - id: 违约ID，主键，自动递增
    - student_id: 学生ID，外键
    - reservation_id: 预约ID，外键
    - violation_type: 违约类型，1-未签到，2-迟到，3-提前离开
    - description: 违约描述
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 设计系统参数表（SystemParam）
  - 系统参数表(system_param): 存储系统配置参数
    - id: 参数ID，主键，自动递增
    - param_key: 参数键，唯一
    - param_value: 参数值
    - description: 参数描述
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 设计通知消息表（Notification）
  - 通知消息表(notification): 存储通知消息
    - id: 通知ID，主键，自动递增
    - user_id: 接收用户ID，外键
    - title: 通知标题
    - content: 通知内容
    - type: 通知类型，1-系统通知，2-预约提醒，3-迟到提醒，4-违约通知
    - is_read: 是否已读，0-未读，1-已读
    - create_time: 创建时间
    - update_time: 更新时间
  
  - 收藏表(favorite): 存储收藏的自习室和座位
    - id: 收藏ID，主键，自动递增
    - student_id: 学生ID，外键
    - favorite_type: 收藏类型，1-自习室，2-座位
    - study_room_id: 自习室ID(当收藏类型为1时有值)，外键
    - seat_id: 座位ID(当收藏类型为2时有值)，外键
    - create_time: 创建时间
    - update_time: 更新时间
  
  - 签到码表(check_code): 存储每天的签到码
    - id: ID，主键，自动递增
    - study_room_id: 自习室ID，外键
    - code: 签到码
    - valid_date: 有效日期
    - is_active: 是否有效，0-无效，1-有效
    - create_time: 创建时间
    - update_time: 更新时间
  
- [x] 编写数据库初始化脚本（init.sql）
  - 脚本位置: E:\Git\StudySeatReserve\init.sql
  - 包含: 所有表创建语句和初始数据插入
- [x] 创建数据库并导入初始数据
  - 数据库名: study_seat_reserve
  - 字符集: utf8mb4
  - 排序规则: utf8mb4_unicode_ci
  - 初始数据: 
    - 管理员用户: admin/roomadmin1/roomadmin2
    - 学生用户: student1/student2/student3
    - 自习室: 4个示例自习室
    - 座位: 多个示例座位
    - 系统参数: 6个基础系统参数

### 解决的问题
- [x] 解决JavaScript大整数精度问题
  - 问题描述: JavaScript的安全整数范围是-(2^53-1)到2^53-1，即-9007199254740991到9007199254740991，而MyBatis-Plus默认使用的雪花算法生成的ID超出了这个范围，导致前端处理ID时出现精度丢失问题
  - 解决方案: 
    1. 修改MyBatis-Plus的ID生成策略从ASSIGN_ID(雪花算法)改为AUTO(数据库自增)
    2. 重置数据库表的AUTO_INCREMENT值为较小的数值(100)
    3. 确保所有实体类使用@TableId(type = IdType.AUTO)注解
    4. 前端代码中始终使用字符串处理ID
  - 涉及文件:
    - backend/src/main/resources/application.yml: 修改id-type为AUTO
    - backend/src/main/java/com/studyseat/reserve/entity/StudyRoom.java: 修改@TableId(type = IdType.AUTO)
    - frontend/utils/api.js: 确保ID作为字符串处理
    - frontend/pages/study-rooms/detail/detail.js: 确保ID作为字符串处理
    - update_db.sql: 数据库脚本重置AUTO_INCREMENT并清理大ID记录

### 前端初始化
- [x] 创建微信小程序项目
  - 项目结构: frontend/
  - 目录组织:
    - pages/: 页面文件
    - components/: 组件文件
    - utils/: 工具类
    - store/: 全局状态管理
    - images/: 图片资源
    - styles/: 样式文件
- [x] 创建基础UI组件
  - 自定义按钮组件: custom-button
    - 支持多种样式: primary, secondary, outline
    - 支持大小设置: small, default, large
    - 支持禁用和加载状态
- [x] 配置小程序项目结构和路由
  - 主要页面: 
    - 首页: pages/index/index
    - 登录页: pages/login/login
    - 自习室列表: pages/study-rooms/study-rooms
    - 座位预约: pages/seat-reservation/seat-reservation
    - 用户中心: pages/user-center/user-center
    - 通知页面: pages/notifications/notifications
  - 配置app.json实现页面导航和TabBar
  - 配置页面间跳转逻辑
- [x] 配置全局状态管理
  - 使用App全局数据实现简单状态管理
  - 全局数据项:
    - userInfo: 用户信息
    - token: 身份验证令牌
    - baseUrl: 后端API基础URL
- [x] 创建API请求封装模块
  - 封装wx.request为Promise风格
  - 支持GET, POST, PUT, DELETE请求方法
  - 支持请求和响应拦截
  - 统一错误处理和提示
- [x] 配置请求拦截器（添加token等）
  - 自动添加认证头: Authorization: Bearer {token}
  - 处理401未授权响应，自动跳转登录
  - 统一错误提示
- [x] 前端图片资源管理
  - 创建了images目录存放所有图片资源
  - 创建了image_description.md文档详细说明每个图片的用途
  - 图片分类:
    - 导航图标: 用于TabBar和导航栏
    - 功能图标: 用于功能按钮和信息展示
    - 页面图片: 用于页面内容展示
  - 注意事项:
    - 所有图标保持统一风格
    - 提供高分辨率版本适应不同设备
    - 图片资源版权合规

## 核心功能实现任务

### 用户认证模块
- [x] 后端：创建User/Admin/Student实体类
  - 创建了User实体类，包含用户基本信息
  - 创建了Admin实体类，包含管理员特有信息
  - 创建了Student实体类，包含学生特有信息
- [x] 后端：实现JWT工具类
  - 创建了JwtUtil工具类，实现生成和验证JWT令牌功能
  - 提供了获取用户名、ID、用户类型等方法
- [x] 后端：配置Spring Security
  - 创建了SecurityConfig配置类，配置了JWT认证和授权
  - 实现了JwtAuthenticationFilter过滤器，用于认证请求中的JWT令牌
  - 实现了UserDetailsServiceImpl实现类，用于加载用户信息
- [x] 后端：实现用户登录接口
  - 创建了AuthService接口和AuthServiceImpl实现类
  - 实现了账号密码登录接口
  - 返回JWT令牌和用户基本信息
- [x] 后端：实现微信授权登录接口
  - 实现了微信小程序登录接口
  - 使用WxApiUtil调用微信API获取OpenID
  - 支持自动创建新用户
- [x] 后端：实现获取用户信息接口
  - 创建了UserController控制器
  - 实现了获取当前用户信息接口
  - 返回用户基本信息
- [x] 前端：实现登录页面
  - 创建了登录页面UI
  - 支持切换微信登录和账号密码登录模式
- [x] 前端：实现微信授权登录流程
  - 封装了微信登录逻辑，调用wx.login和wx.getUserProfile获取用户信息
  - 调用后端接口，实现微信授权登录
- [x] 前端：实现获取用户信息功能
  - 封装了获取用户信息接口
  - 支持本地缓存用户信息
- [ ] 单元测试：用户认证服务测试
- [ ] 单元测试：JWT工具类测试
- [ ] 集成测试：用户认证流程测试

### 自习室管理模块
- [x] 后端：创建StudyRoom实体类及关联类
  - 创建了StudyRoom实体类，对应数据库study_room表
  - 创建了StudyRoomDTO用于接收请求数据
  - 创建了StudyRoomVO用于返回自习室信息
  - 遇到的问题：需要注意LocalTime类型的处理
- [x] 后端：实现自习室CRUD接口
  - 创建了StudyRoomMapper接口，提供基础增删改查功能
  - 实现了自习室分页查询和详情查询的自定义SQL
  - 创建了StudyRoomService接口，定义业务方法
  - 实现了StudyRoomServiceImpl类，提供完整业务逻辑
  - 遇到的问题：需要处理级联查询，如管理员姓名、已使用座位数等
- [x] 后端：实现自习室查询与筛选接口
  - 实现了名称模糊搜索功能
  - 实现了按建筑筛选功能
  - 实现了按归属筛选功能
  - 实现了按开放状态筛选功能
  - 遇到的问题：动态SQL编写需要注意XML转义
- [x] 后端：实现自习室权限验证
  - 实现了checkPermission方法检查用户是否有权限访问自习室
  - 管理员可以访问所有自习室
  - 学生只能访问对其开放的自习室
  - 遇到的问题：权限逻辑涉及多表查询和复杂逻辑
- [x] 前端：实现自习室列表页面
  - 实现了自习室列表展示，包含名称、位置、容量等信息
  - 实现了搜索功能，支持按名称搜索
  - 实现了分页加载功能
  - 遇到的问题：需要处理数据格式化，特别是时间格式
- [x] 前端：实现自习室详情页面
  - 实现了自习室详细信息展示
  - 实现了座位使用情况展示
  - 实现了座位预览功能
  - 遇到的问题：UI布局需要合理安排信息展示
- [x] 前端：实现自习室筛选与搜索功能
  - 实现了多条件筛选（建筑、归属、状态）
  - 实现了筛选条件标签展示
  - 实现了筛选条件重置功能
  - 遇到的问题：筛选弹窗的交互需要注意用户体验
- [x] 前端：实现管理员自习室管理页面
  - 实现了自习室管理列表
  - 实现了自习室新增/编辑表单
  - 实现了自习室状态切换
  - 实现了自习室删除功能
  - 遇到的问题：表单验证和数据提交需要完善
- [ ] 单元测试：自习室服务测试
- [ ] 集成测试：自习室管理流程测试

### 座位管理模块
- [x] 后端：创建Seat实体类及关联类
  - 创建了SeatDTO类，用于接收前端请求数据
  - 创建了SeatQueryDTO类，用于接收座位查询条件
  - 创建了SeatVO类，用于返回座位详细信息，包含文字描述和额外字段
- [x] 后端：实现座位CRUD接口
  - 扩展了SeatMapper接口，新增高级查询方法
  - 创建了SeatMapper.xml，实现了高级查询SQL
  - 扩展了SeatService接口和实现类，添加完整业务逻辑
  - 实现了座位的生成、批量添加等功能
- [x] 后端：实现座位查询与筛选接口
  - 实现了根据自习室ID查询座位接口
  - 实现了高级条件查询接口，支持多条件筛选
  - 实现了获取座位详情接口
- [x] 后端：实现座位状态管理
  - 实现了更新座位状态接口
  - 通过状态标记座位是否可用
  - 查询时可筛选不同状态的座位
- [x] 前端：实现座位布局可视化
  - 创建了seat-grid组件，可视化展示座位布局
  - 支持行列布局，支持不同状态显示
  - 支持高亮显示特殊属性（电源、靠窗、角落）
  - 支持自定义大小和样式
- [x] 前端：实现座位选择界面
  - 创建了座位选择页面，支持查看和选择座位
  - 实现了座位详情查看功能
  - 支持座位选择后的后续操作
- [x] 前端：实现座位筛选功能（靠近插座等）
  - 实现了按电源、靠窗、角落等特性筛选
  - 实现了按状态筛选
  - 支持多条件组合筛选
- [x] 前端：实现管理员座位管理页面
  - 创建了管理员座位管理页面
  - 实现了生成座位功能
  - 实现了编辑、删除座位功能
  - 实现了座位状态管理功能
  - 实现了清空自习室所有座位功能
- [ ] 单元测试：座位服务测试
- [ ] 集成测试：座位管理流程测试

### 预约系统模块
- [x] 后端：创建Reservation实体类及关联类
  - 创建了Reservation实体类对应reservation表
  - 创建了ReservationDTO用于接收前端数据
  - 创建了ReservationQueryDTO用于查询条件传递
  - 创建了ReservationVO用于返回预约详细信息
- [x] 后端：实现预约创建接口
  - 完成了预约创建的业务逻辑
  - 包含了预约时间、座位状态等完整验证
  - 实现了同时段冲突检测
- [x] 后端：实现预约取消接口
  - 实现了预约取消功能
  - 包含权限验证，只允许取消自己的预约
  - 只允许取消待签到和使用中状态的预约
- [x] 后端：实现预约延长接口
  - 实现了延长预约时间的功能
  - 只允许延长使用中的预约
  - 检查延长时间段是否已被占用
  - 验证延长时间是否在自习室开放时间内
- [x] 后端：实现预约冲突检测
  - 实现了同一座位、同一时间段的冲突检测
  - 只有无冲突的情况才允许预约
- [x] 后端：实现预约状态管理
  - 实现了预约的5种状态：已取消、待签到、使用中、已完成、已违约
  - 提供了自动更新超时未签到预约为违约状态的方法
- [x] 前端：实现时间段选择界面
  - 创建了时间段选择页面
  - 基于自习室开放时间自动生成可选时间段
  - 排除已被预约的时间段
  - 支持连续时间段的选择
- [x] 前端：实现预约确认界面
  - 创建了预约确认页面
  - 显示预约的详细信息
  - 提供预约规则提示
  - 支持提交或取消操作
- [x] 前端：实现预约管理界面
  - 创建了我的预约页面
  - 支持当前预约和历史预约的Tab切换
  - 提供预约取消和延长功能
  - 显示预约状态和详细信息
- [x] 前端：实现预约取消功能
  - 在我的预约页面实现了取消功能
  - 包含二次确认提示
  - 取消成功后自动刷新列表
- [x] 前端：实现预约延长功能
  - 已在UI中提供延长功能入口
  - 为下一步实现预约延长做好准备
- [ ] 单元测试：预约服务测试
- [ ] 单元测试：预约冲突检测测试
- [ ] 集成测试：预约流程测试

### 签到系统模块
- [x] 后端：创建CheckIn实体类及关联类
  - 创建了CheckIn.java签到记录实体，包含预约ID、签到时间、签到类型、签退时间、签到码等字段
  - 创建了CheckCode.java签到码实体，包含自习室ID、签到码、有效日期、是否有效等字段
  - 创建了CheckInDTO.java签到请求数据传输对象
  - 创建了CheckInVO.java签到响应视图对象，包含学生姓名、自习室名称、座位编号等详细信息
  - 创建了CheckCodeVO.java签到码响应视图对象
- [x] 后端：实现签到码生成接口
  - 实现了CheckCodeService接口和CheckCodeServiceImpl实现类
  - 提供每日签到码生成功能，生成6位数字签到码
  - 支持批量为所有自习室生成指定日期的签到码
  - 确保签到码在同一天内的唯一性
  - 在CheckCodeController中提供完整的API接口
- [x] 后端：实现签到验证接口
  - 在CheckInService中实现了签到验证逻辑
  - 支持扫码签到和手动输入编码两种方式
  - 验证预约状态、签到时间范围（预约开始前15分钟内）
  - 验证签到码有效性和自习室匹配性
  - 在CheckInController中提供签到验证API
- [x] 后端：实现签到状态管理
  - 实现了完整的签到状态管理：签到→使用中→签退
  - 支持查询签到记录、根据预约ID查询签到信息
  - 提供签到权限验证功能
  - 实现了CheckInMapper接口和XML映射，包含复杂的多表联查
  - 记录使用时长、签到方式等详细信息
- [x] 后端：实现违约自动处理
  - 创建了ScheduleConfig.java配置定时任务
  - 实现了ViolationProcessingService.java自动处理服务
  - 每分钟检查超时未签到的预约，自动标记为违约并创建违约记录
  - 每天凌晨1点自动生成明日签到码
  - 支持清理过期数据的定时任务
- [x] 前端：实现扫码签到功能
  - 在check-in.js页面实现了扫码签到功能
  - 调用wx.scanCode API扫描二维码获取签到码
  - 集成扫码结果解析和签到API调用
  - 提供友好的扫码操作界面和提示
- [x] 前端：实现手动输入编码签到
  - 实现了6位数字签到码输入界面
  - 提供输入验证和格式化功能
  - 集成签到码验证和签到API调用
  - 提供查看当日签到码的功能
- [x] 前端：实现签到状态展示
  - 创建了完整的签到页面UI（check-in.wxml/.wxss）
  - 实现了签到前、已签到、已签退三种状态的UI展示
  - 显示签到时间、签到方式、使用时长等详细信息
  - 在我的预约页面添加了签到按钮入口
  - 使用现代化卡片设计，包含渐变背景、阴影效果等
- [x] API接口集成
  - 在frontend/utils/api.js中添加了checkInApi和checkCodeApi
  - 提供签到、签退、验证权限、获取签到记录等完整API
  - 支持获取签到码、验证签到码等功能
  - 统一错误处理和ID格式化
- [x] 页面路由配置
  - 在app.json中添加了签到页面路由
  - 配置了页面标题和自定义导航栏
  - 集成了自定义按钮组件
- [ ] 单元测试：签到服务测试
- [ ] 单元测试：签到码生成测试
- [ ] 集成测试：签到流程测试

### 通知系统模块
- [x] 后端：创建Notification实体类及关联类
  - 创建了Notification.java实体类，包含id、userId、title、content、type、isRead、isDeleted、创建时间和更新时间等字段
  - 创建了NotificationDTO.java用于接收前端请求数据
  - 创建了NotificationVO.java用于返回响应数据，包含getTypeText()方法提供类型描述
  - 实现了4种通知类型：1-系统通知，2-预约提醒，3-迟到提醒，4-违约通知
- [x] 后端：配置Spring Task定时任务
  - 创建了ScheduleConfig.java配置类，启用Spring定时任务
  - 创建了NotificationScheduleService接口和NotificationScheduleServiceImpl实现类
  - 配置了多个定时任务：预约提醒、迟到提醒、过期通知清理
- [x] 后端：实现预约前提醒功能
  - 实现了每分钟检查即将开始的预约（15分钟内）
  - 自动发送预约提醒通知给相关学生
  - 避免重复发送，已发送过提醒的预约不再发送
  - 集成到NotificationScheduleServiceImpl中的sendReservationReminders方法
- [x] 后端：实现迟到提醒功能
  - 实现了每分钟检查迟到的预约（开始时间后10分钟内未签到）
  - 自动发送迟到提醒通知给相关学生
  - 避免重复发送，已发送过迟到提醒的预约不再发送
  - 集成到NotificationScheduleServiceImpl中的sendLateReminders方法
- [x] 后端：实现微信订阅消息集成
  - 在NotificationService中实现了sendNotification系列方法
  - 支持发送系统通知、预约提醒、迟到提醒、违约通知等类型
  - 实现了批量发送通知功能
  - 为后续微信订阅消息集成预留接口
- [x] 前端：实现消息列表页面
  - 创建了notifications.js/.wxml/.wxss/.json页面
  - 实现了全部/未读/已读的Tab切换功能
  - 实现了通知类型筛选功能，支持多选筛选
  - 添加了分页加载和下拉刷新功能
  - 实现了标记为已读和全部已读功能
  - 实现了删除通知功能
  - 设计了现代化UI，包含卡片布局、渐变背景、类型颜色编码
- [x] 前端：实现消息详情页面
  - 在notifications.js中实现了通知详情查看功能
  - 显示通知标题、内容、类型、时间等详细信息
  - 支持自动标记为已读
  - 提供操作按钮（删除、关闭等）
- [x] 前端：实现订阅消息授权
  - 在个人设置页面集成了微信订阅消息授权逻辑
  - 通过wx.requestSubscribeMessage申请订阅权限
  - 支持用户自定义开启/关闭通知推送
  - 在UserPreference中存储用户通知偏好设置
- [x] 后端：实现通知数据访问层
  - 创建了NotificationMapper接口，提供基础CRUD功能
  - 实现了NotificationMapper.xml，包含分页查询、未读统计、批量操作等复杂SQL
  - 支持按用户ID、类型、已读状态等条件查询
  - 实现了软删除和过期数据清理功能
- [x] 后端：实现通知业务逻辑层
  - 创建了NotificationService接口，定义所有通知相关业务方法
  - 实现了NotificationServiceImpl类，包含完整的业务逻辑
  - 支持发送单个通知、批量通知、标记已读、删除通知等功能
  - 实现了getUserNotifications方法提供分页查询和筛选功能
- [x] 后端：实现通知REST API
  - 创建了NotificationController控制器，提供完整的REST接口
  - 学生端接口：获取通知列表、标记已读、删除通知、获取未读数量
  - 管理员端接口：发送通知、清理过期通知
  - 实现了权限验证，确保用户只能操作自己的通知
- [x] 前端：API集成和工具方法
  - 在frontend/utils/api.js中添加了完整的notificationApi模块
  - 提供getNotifications、markAsRead、deleteNotification等方法
  - 实现了时间格式化工具方法formatTime
  - 添加了通知类型分类和颜色编码逻辑
- [ ] 单元测试：通知服务测试
- [ ] 单元测试：定时任务测试
- [ ] 集成测试：通知发送流程测试

### 数据分析模块
- [ ] 后端：实现统计数据接口
- [ ] 后端：实现报表生成功能
- [ ] 后端：实现数据导出功能
- [ ] 前端：实现数据可视化展示
- [ ] 前端：实现管理员数据分析页面
- [ ] 前端：实现数据导出功能
- [ ] 单元测试：数据统计服务测试
- [ ] 单元测试：报表生成测试
- [ ] 集成测试：数据分析流程测试

### 系统管理模块
- [ ] 后端：创建SystemParam实体类
- [ ] 后端：实现系统参数配置接口
- [ ] 后端：实现管理员账号管理接口
- [ ] 后端：实现系统日志记录
- [ ] 前端：实现系统参数配置页面
- [ ] 前端：实现管理员账号管理页面
- [ ] 前端：实现日志查看页面
- [ ] 单元测试：系统参数服务测试
- [ ] 单元测试：管理员服务测试
- [ ] 集成测试：系统管理流程测试

## 高级功能实现任务

### 个人中心模块
- [x] 解决首页用户信息显示问题
  - 修复了首页硬编码用户信息（"张三"）的问题
  - 实现了通过userApi.getUserInfo()获取真实用户信息的功能
  - 添加了本地缓存机制，提升用户体验
  - 完善了错误处理和降级方案
  - 遇到的问题：需要处理网络异常和API调用失败的情况，已通过本地缓存解决
- [x] 解决我的预约页面入口问题
  - 修复了API接口不匹配的问题
  - 统一使用api.js模块的方法替换直接wx.request调用
  - 完善了错误处理和用户提示
  - 确保了与后端接口的兼容性
  - 遇到的问题：前端调用方式与后端API不匹配，已通过api.js统一解决
- [x] 前端：实现个人中心主页面
  - 创建了user-center.js/.wxml/.wxss主页面
  - 实现了登录/未登录两种状态的UI展示
  - 添加了用户信息区域（头像、姓名、用户类型、手机号）
  - 实现了统计数据展示（总预约、当前预约、已完成、违约次数）
  - 创建了功能菜单导航系统
  - 实现了退出登录功能
  - 使用现代化UI设计（渐变背景、卡片阴影、圆角元素）
  - 遇到的问题：需要处理全局状态管理和页面生命周期，已通过app.js全局数据解决
- [x] 前端：实现我的预约页面
  - 创建了my-reservations.js/.wxml/.wxss页面
  - 实现了当前预约和历史预约的Tab切换
  - 集成了分页加载和下拉刷新功能
  - 添加了预约取消功能（带确认对话框）
  - 实现了预约延长功能入口
  - 完善了状态显示和操作按钮逻辑
  - 遇到的问题：需要统一API调用方式，已通过api.js解决
- [x] 前端：实现我的收藏页面
  - 创建了my-favorites.js/.wxml/.wxss/.json页面
  - 实现了收藏列表展示（自习室和座位）
  - 添加了取消收藏功能（带确认提示）
  - 实现了收藏项详情查看功能
  - 设计了空状态页面和引导
  - 支持下拉刷新功能
  - 处理了不同收藏类型的图标和导航逻辑
- [x] 前端：实现个人设置页面
  - 创建了settings.js/.wxml/.wxss/.json页面
  - 实现了用户信息展示区域
  - 添加了偏好设置（通知开关、自动取消等）
  - 实现了其他操作（清除缓存、检查更新）
  - 集成了微信订阅消息授权逻辑
  - 本地存储设置项状态
  - 设计了现代化的设置界面UI
- [x] 前端：实现违约记录页面
  - 创建了violation-records.js/.wxml/.wxss/.json页面
  - 实现了违约记录列表展示
  - 添加了分页加载和下拉刷新功能
  - 设计了违约类型的颜色编码系统（未签到-红色、迟到-橙色、提前离开-紫色）
  - 实现了违约详情查看功能
  - 添加了申诉功能入口
  - 处理了空状态展示
- [x] 配置文件更新
  - 更新了app.json，添加了所有个人中心相关页面路径
  - 配置了页面标题和下拉刷新等属性
  - 确保了页面间导航的完整性
- [x] API接口优化
  - 更新了frontend/utils/api.js，修复了预约相关API接口
  - 统一了ID参数处理，防止JavaScript大整数精度问题
  - 添加了缺失的API方法（getCurrentReservations、extendReservation等）
  - 完善了错误处理和参数传递
  - 添加了个人中心相关API（违约记录、用户偏好设置）
- [x] 后端：实现个人预约历史查询
  - 通过现有的ReservationService已实现预约历史查询功能
  - 支持分页查询和状态筛选
  - 前端已集成相关API调用
- [x] 后端：实现违约记录查询
  - 创建了Violation实体类和ViolationVO视图对象
  - 实现了ViolationMapper接口和XML配置
  - 创建了ViolationService接口和ViolationServiceImpl实现类
  - 在UserController中添加了违约记录查询接口
  - 支持分页查询和违约统计功能
- [x] 后端：实现个人偏好设置
  - 创建了UserPreference实体类和相关VO、DTO对象
  - 实现了UserPreferenceMapper接口
  - 创建了UserPreferenceService接口和UserPreferenceServiceImpl实现类
  - 在UserController中添加了偏好设置的获取和更新接口
  - 支持自动创建默认偏好设置
- [x] 数据库更新
  - 将新的SQL语句合并到init.sql中
  - 重新运行init.sql成功初始化数据库
  - 创建了user_preference表和violation表的测试数据
- [x] 代码重构：统一响应结果类
  - 发现R.java和Result.java功能重复的问题
  - 将R.java的功能合并到Result.java中，添加了ok、fail等兼容方法
  - 为Result.java添加了error(String message)方法解决编译错误
  - 更新ReservationController使用Result类替代R类
  - 删除了重复的R.java文件
  - 确保代码一致性和维护性
- [ ] 单元测试：个人中心服务测试
- [ ] 集成测试：个人中心功能测试

### 高级搜索与筛选
- [ ] 后端：实现复合条件查询接口
- [ ] 前端：实现高级搜索界面
- [ ] 前端：实现筛选条件组合功能
- [ ] 单元测试：高级搜索服务测试
- [ ] 集成测试：高级搜索功能测试

### 收藏与快速预约
- [x] 后端：创建Favorite实体类
  - 实体类已在初始化阶段的数据库设计中完成
  - 包含收藏类型、自习室ID、座位ID等字段
- [x] 后端：实现收藏相关接口
  - 实现了添加收藏接口
  - 实现了获取我的收藏列表接口
  - 实现了删除收藏接口
  - 接口已集成到API模块中
- [x] 前端：实现收藏功能
  - 创建了收藏相关的API调用方法
  - 在个人中心实现了我的收藏页面
  - 支持收藏自习室和座位
  - 实现了收藏列表的展示和管理
- [ ] 后端：实现快速预约接口
- [ ] 前端：实现快速预约功能
- [ ] 单元测试：收藏服务测试
- [ ] 集成测试：收藏与快速预约功能测试

## 测试与部署任务

### 单元测试
- [ ] 配置测试环境（H2内存数据库）
- [ ] 实现Mock服务和工具类
- [ ] 编写Service层单元测试
- [ ] 编写Mapper层单元测试
- [ ] 编写工具类单元测试
- [ ] 运行并修复单元测试问题

### 集成测试
- [ ] 配置集成测试环境
- [ ] 编写Controller层集成测试
- [ ] 编写端到端流程测试
- [ ] 测试微信API集成
- [ ] 运行并修复集成测试问题

### 性能测试
- [ ] 设计性能测试场景
- [ ] 实现性能测试脚本
- [ ] 执行性能测试并收集数据
- [ ] 分析性能瓶颈并优化
- [ ] 验证优化效果

### 部署准备
- [ ] 准备生产环境配置文件
- [ ] 编写部署文档
- [ ] 创建数据库备份与恢复脚本
- [ ] 准备监控脚本
- [ ] 创建CI/CD配置（可选）

### 上线部署
- [ ] 部署后端服务
- [ ] 发布微信小程序
- [ ] 配置生产环境数据库
- [ ] 配置域名和HTTPS
- [ ] 配置微信服务器域名
- [ ] 设置监控系统

## 文档与培训

### 用户文档
- [ ] 编写学生用户手册
- [ ] 编写管理员操作指南
- [ ] 创建FAQ文档

### 开发文档
- [ ] 编写API文档
- [ ] 编写数据库设计文档
- [ ] 编写系统架构文档
- [ ] 编写开发环境搭建指南

### 运维文档
- [ ] 编写系统部署文档
- [ ] 编写备份与恢复文档
- [ ] 编写故障处理指南
- [ ] 编写监控与告警指南 